from langchain_core.output_parsers import JsonOutputParser
import re
from pydantic import BaseModel, Field
import asyncio
from datetime import datetime
import os
from src.llms.llm import (
    get_llm_by_type,
    get_llm_token_limit_by_type,
)
env = os.getenv
class ReportInfoRulesBegining(BaseModel):
    part1: str = Field(..., description="第一部分报告正文。")
    part2: str = Field(..., description="第二部分报告正文。")
    part3: str = Field(..., description="第三部分报告正文。")
    part4: str = Field(..., description="第四部分报告正文。")
    part5: str = Field(..., description="第五部分报告正文。")


async def report_write_summary_begining(title, writing_tag, company_name, data_text):
    llm = get_llm_by_type("reasoning")
    parser = JsonOutputParser(pydantic_object=ReportInfoRulesBegining)

    current_year = datetime.now().year

    begining_config = {
        '董事会声明': f'''
            # Task
            请结合历史材料为 {company_name}，通过网络检索适当补充材料中明显遗漏的信息，撰写《年度环境、社会及管治（ESG）报告》的“董事会声明”。
    
            # Writing Logic (必须分三个自然段落逻辑撰写，不设标题)
            1. **第一段：监管承诺与责任主体 (The "Oversight" Paragraph)**
               - 必须明确开宗明义：“董事会是 {company_name} ESG事宜的最高责任与决策机构。”
               - 描述董事会如何监督ESG策略的制定，以及如何确保ESG风险管理融入公司的整体风险管理体系。
               - *关键词建议*：全权负责、顶层设计、风险管控、长期价值。
    
            2. **第二段：实质性与过程管理 (The "Process" Paragraph)**
               - 描述本年度董事会如何参与了“实质性议题（Materiality Assessment）”的评估与排序。
               - 提及董事会对关键ESG指标（如碳排放、安全事故率）的定期检视情况。
               - *关键词建议*：实质性议题、定期审视、利益相关方沟通、持续追踪。
    
            3. **第三段：未来承诺与展望 (The "Outlook" Paragraph)**
               - 结合中国宏观背景（如“高质量发展”、“双碳目标”），表达对未来可持续发展的承诺。
               - 以签署人名义结束。
    
            # Tone Calibration (中国特色)
            - 请融入“高质量发展”、“长期主义”、“稳健经营”等符合中国资本市场语境的词汇。
            - 避免空洞口号，强调“机制”和“落实”。
            - 凡是出现了时间范围，统一改为使用当前年份{current_year}
    
            请严格按照以下 JSON 模板输出，不允许出现额外文字、不允许出现 Markdown：
            {JsonOutputParser(pydantic_object=ReportInfoRulesBegining).get_format_instructions()}
        ''',
        '管理层致辞': f'''
            # Task
            请结合历史材料为 {company_name}，通过网络检索适当补充材料中明显遗漏的信息，撰写《年度环境、社会及管治（ESG）报告》的“董事会声明”。
            # Writing Logic (必须分四段式叙事，不设标题)
            1. **第一段：破题与回顾 (Opening & Resilience)**
               - 以感性的笔触回顾{data_text}。面对宏观挑战（如全球供应链波动、气候异常），公司如何保持“韧性”（Resilience）。
               - 核心思想：ESG不是成本，而是穿越周期的核心竞争力。
    
            2. **第二段：业务与ESG的融合 (Integration)**
               - 具体的行动段落。讲述公司如何将ESG理念融入业务关键环节，（如产品研发、生产制造或客户服务中）。
               - 1-2个具体的业务亮点（如“我们的低碳产品占比达到...”）。
    
            3. **第三段：以人为本与生态共赢 (People & Partners)**
               - 聚焦于“人”（员工）和“伙伴”（供应链/社区）。
               - 感谢员工的奋斗，提及对供应链的赋能，体现“共创共享”的价值观。
    
            4. **第四段：行动号召 (Call to Action)**
               - 展望未来，重申对在业务中融入ESG关键元素（如“技术创新”或“绿色转型”）的坚持。
               - 结尾句要充满力量感。
    
            # Tone Calibration
            - 风格要比董事会声明更亲切、更有活力。
            - 多用动词（如“驱动”、“重塑”、“连接”）。
            - 凡是出现了时间范围，统一改为使用当前年份{current_year}
    
            请严格按照以下 JSON 模板输出，不允许出现额外文字、不允许出现 Markdown：
            {JsonOutputParser(pydantic_object=ReportInfoRulesBegining).get_format_instructions()}
        ''',
        '关于#企业#': f'''
            # Task
            请结合历史材料为 {company_name}，通过网络检索适当补充材料中明显遗漏的信息，撰写《年度ESG报告》的“关于我们”章节。
    
            # Writing Logic (必须分三段式叙事，不设标题)
            1. **第一段：身份定义与使命 (Who we are)**
               - 介绍企业的基本属性，但必须结合“企业愿景与使命”。
               - 示例：不仅说“我们是造车的”，要说“我们致力于为全球提供智慧绿色出行方案”。
    
            2. **第二段：规模与全球布局 (Scale & Reach)**
               - 描述业务版图（国内外布局）。
               - 强调规模效应带来的社会影响力（如：为全球X万客户提供服务，创造了X万个就业岗位）。
    
            3. **第三段：可持续价值主张 (Value Proposition)**
               - 总结性陈述。阐述企业的技术或服务如何帮助社会解决问题（如：通过数字化提升效率，通过清洁能源改善环境）。
               - 强调“创新驱动”和“卓越运营”。
    
            # Tone Calibration
            - 语言简练有力，避免冗长的流水账。
            - 凡是出现了时间范围，统一改为使用当前年份{current_year}
    
            请严格按照以下 JSON 模板输出，不允许出现额外文字、不允许出现 Markdown：
            {JsonOutputParser(pydantic_object=ReportInfoRulesBegining).get_format_instructions()}
        ''',
        '关于本报告': f'''
            Task
            请结合历史材料为 {company_name}，通过网络检索适当补充材料中明显遗漏的信息，撰写《年度ESG报告》的“关于我们”章节。
            
            # Writing Logic (必须分多段式叙事，不设标题)
            1. 报告目的与原则（Purpose）
            说明 ESG 报告的发布目的、信息披露原则，例如：透明、真实、完整、可比、平衡性原则，体现企业在 ESG 方面的战略、管理、绩效
            
            2. 报告编制依据（Standards & References）
            必须清楚列出本报告参考的标准，例如：
            香港联交所《环境、社会及管治报告守则》（适用于港股）
            GRI Sustainability Reporting Standards
            ISSB IFRS S1/S2
            UN SDGs
            其他行业规范或评级机构要求（如 MSCI、Sustainalytics）
            
            3. 报告范围（Scope）
            需包含以下内容（模型必须输出）：
            组织范围：公司本部、子公司、合并范围或业务板块
            时间范围：使用当前年份+历史材料中披露的按月记报告时间范围，如果没有这部分信息使用当前年份的自然年： {current_year} 年 1 月 1 日—{current_year} 年 12 月 31 日
            报告周期：年度报告（Annual）        
            如部分数据有溯及或前瞻性，请说明。
            
            4. 数据来源与可靠性（Data Source & Assurance）        
            需要说明：       
            数据来源（内部管理系统、统计报表、公开信息等）        
            数据的计算方法（如适用）        
            数据是否经过第三方核查（如有，写明；无则写“未进行强制性鉴证”）
            
            5. 报告原则（Reporting Principles）        
            必须包括以下四类原则（可根据标准适当补充）：        
            重要性（Materiality）        
            量化（Quantitative）        
            一致性（Consistency）       
            平衡性（Balance）       
            如使用了“重要性评估方法”，请注明其基本流程。
            
            6. 获取方式（Availability）        
            说明报告获取方式，例如网站、下载二维码等。
                    
            7. 意见反馈（Feedback）        
            提供反馈渠道，例如：        
            企业官网        
            ESG 邮箱        
            联系方式（如适合披露）
            
            请严格按照以下 JSON 模板输出，可增减part段落数量，但格式必须一致，不允许出现额外文字、不允许出现 Markdown：
            {JsonOutputParser(pydantic_object=ReportInfoRulesBegining).get_format_instructions()}
        '''
    }

    system_prompt = begining_config[f'{writing_tag}']

    user_prompt = f"""以下是收集的章节标题和下级标题章节正文
    章节标题：{title}
    历史材料：{data_text}
    """

    output_text = ""

    print("📘 开始生成报告内容（流式输出）...\n")



    async for chunk in llm.astream([
        {"role": "system", "content": system_prompt},
        {"role": "user", "content": user_prompt}
    ]):
        if chunk.content:
            print(chunk.content, end='', flush=True)
            output_text += chunk.content  # ✅ 拼接保存

    company_info = parser.parse(output_text)
    return company_info


def clean_markdown(text: str) -> str:
    # 去除标题符号 ##
    text = re.sub(r'#+\s*', '', text)
    # 去除加粗 **
    text = re.sub(r'\*\*(.*?)\*\*', r'\1', text)
    # 去除斜体 *
    text = re.sub(r'\*(.*?)\*', r'\1', text)
    # 去除引用 >
    # text = re.sub(r'^\s*>\s*', '', text, flags=re.MULTILINE)
    # 去除列表符号 - 或 *
    text = re.sub(r'^[\-\*]\s+', '', text, flags=re.MULTILINE)
    # 去除分隔线 ---
    text = re.sub(r'\n-{3,}\n', '\n', text)
    # 去除多余空白
    text = re.sub(r'\n{2,}', '\n', text)
    return text.strip()


async def main_report_writing_begining(title, writing_tag, company_name, data_text, max_retries=3):
    for attempt in range(1, max_retries + 1):
        try:
            paragraph_report_texts = await report_write_summary_begining(title, writing_tag, company_name, data_text)
            if not paragraph_report_texts and not isinstance(paragraph_report_texts, dict):
                raise ValueError("report_write 输出为空或格式错误")
            else:
                print("✅ 报告开篇生成成功")
                break
        except Exception as e:
            print(f"⚠️ report_write() 失败：{e}")
            if attempt == max_retries:
                try:
                    paragraph_report_texts = await report_write_summary_begining(title, writing_tag, company_name, data_text)
                except:
                    print("🚫 report_write() 达到最大重试次数，退出流程。")
                    paragraph_report_texts = ''
            await asyncio.sleep(2)
    paragraph_report = ""
    for part, content in paragraph_report_texts.items():
        paragraph_report += f"{clean_markdown(content)}\n\n"

    print("报告全部生成成功！")
    print(paragraph_report)
    return paragraph_report


if __name__ == '__main__':
    import time

    start_time = time.time()
    company_name = '金蝶国际软件集团有限公司'
    title = "关于本报告"
    data_text = "本报告是金蝶国际软件集团有限公司（以下简称金蝶国际、金蝶、本集团或我们）发布的第份环境、社会及管治报告（以下简称本报告）。报告秉承客观、规范、透明的原则，本报告系统性披露了集团及其附属子公司在环境、社会治理方面的理念、策略、举措和成效。我们期望通过发布报告的方式回应利益相关方关切，凝聚共识，共同推进环境、社会、经济的可持续发展。编制依据本报告依据香港联合交易所有限公司（以下简称香港联交所）主板上市规则附录《环境、社会及管治报告守则》（以下简称报告守则）编制，同时参考香港联交所气候信息披露指引所建议采用的框架、全球可持续发展标准委员会发布的可持续发展报告标准、国际评级机构评级标准，并结合联合国可持续发展目标编写。报告范围组织范围：本报告覆盖金蝶国际及其附属子公司，除特别说明外，相关信息与数据统计口径与金蝶国际股票代码年年度报告合并财务报表范围一致。时间范围：年月日至年月日（以下简称本年度或报告期内）。为增强报告的可比性、完整性以及信息的持续性，部分披露内容适当有所延伸。数据来源本报告所披露的信息和数据均来自集团及其下属企业内部正式文件、统计报告和有关公开材料。本报告中所涉及货币种类及金额如无特殊说明，均以人民币为计量单位。汇报原则在本报告编制过程中，依据重要性、量化、平衡及一致性原则，以界定报告的内容及信息的呈列方式。重要性原则：本报告已在编制过程中识别主要利益相关方及其关注的议题，并根据议题的重要性水平在报告中进行针对性披露。有关重要性评估的过程及结果，请参见后文“利益相关方沟通与参与”与“重要性议题评估”小节。量化原则：本报告采用量化数据的方式展现环境与社会层面的关键绩效指标。有关本报告中关键绩效指标的计量标准、方法、假设及/或计算工具以及使用的转换系数来源，均已在相应位置（如适用）作出说明。可靠性保证本集团承诺本报告内容不存在任何虚假记录、误导性陈述或重大遗漏，并对内容的真实性、准确性和完整性负责。报告获取本报告以电子版方式提供，您可登录金蝶国际官方网站、香港联交所披露易网站线上浏览或下载。意见反馈如您对本报告有任何疑问或建议，欢迎扫描右侧二维码或通过电子邮箱向我们反馈，谢谢。",
    result_content = ['鉴于企业管治在可持续发展中的重要性，金蝶国际严格遵循《中华人民共和国数据安全法》、《中华人民共和国个人信息保护法》、《中华人民共和国网络安全法》以及《非银行支付机构监督管理条例》等法律法规，并积极响应全球倡议。我们致力于建立全面高效的三级管治架构，确保在业务决策和日常运营中充分考虑环境、社会及管治因素的潜在影响与风险及机遇。\n\n我们已建立全面高效的三级管治架构，各层级职责清晰，通过董事会及战略与可持续发展委员会监督及规划，管理层推动执行层落实，系统性推进集团可持续发展管治。我们在2025年进一步强化了气候变化应对的管理职责，将低碳转型纳入企业发展的核心议程。我们通过制定和实施全流程数据安全管理制度，确保数据处理活动符合法律法规要求。同时，我们建立了数据分类分级保护制度，对不同类型的数据采取差异化的保护措施。此外，我们在处理个人信息时进行风险评估，确保用户权益得到充分保护。我们还投入资源建设和维护安全的基础设施，部署防火墙、入侵检测等安全控制设施，以应对网络安全威胁。对于支付类业务，我们确保业务系统的连续性、安全性和可溯源性，满足严格的监管要求。\n\n我们的三级管治架构有效提升了集团的可持续发展能力。通过董事会及战略与可持续发展委员会的监督，管理层能够系统性地推进可持续发展管治。2025年，我们将气候变化应对的管理职责进一步强化，确保低碳转型成为企业发展的核心议程。我们通过建立全流程数据安全管理制度，显著降低了数据泄露和滥用的风险。数据分类分级保护制度的实施，使我们能够更好地识别和保护关键数据资产。在处理个人信息方面，我们进行了多次风险评估，确保用户隐私得到妥善保护。我们还通过建设和维护安全的基础设施，成功抵御了多次网络攻击，保障了业务的连续性和稳定性。特别是在支付类业务中，我们确保了业务系统的连续性、安全性和可溯源性，赢得了客户和监管机构的信任。\n\n',
                      '鉴于企业管治对于可持续发展的重要性，金蝶国际积极响应并支持全球倡议，如ISO 30415等指导性标准，并严格遵守《中华人民共和国公司法》、香港联合交易所有限公司《证券上市规则》附录十四《企业管治守则》等相关法律法规。我们致力于构建透明高效的治理架构，确保企业运营符合最高标准。\n\n金蝶国际建立了全面有效的三层管治架构。董事会作为最高责任及决策机构，对策略及报告承担全部责任，定期审阅并批准战略、政策、目标及重点工作事项，同时检讨目标进展。董事会下设战略与可持续发展委员会，负责制定战略规划和具体目标，监督并指导专项工作组推进整体工作。我们积极探索绩效考核联动机制，将关键指标纳入高层和中层管理者考核体系，确保战略目标的有效落实。集团董事会下设审核委员会、薪酬委员会、提名委员会以及战略与可持续发展委员会，共同构成了权责分明、各司其职的董事会治理架构。董事会及各专门委员会定期召开会议，确保集团的重大决策程序规范、透明、有效，维护股东及其他利益相关方的权益。我们已制定独立非执行董事的独立要求，包括持股限制、关联限制、利益往来限制等，以确保独立非执行董事能独立公正地履行职责。此外，我们制定了董事会多元化政策，确保在性别、年龄、种族或民族、国籍、文化、专业知识与技能等方面的多元化因素得到考虑。年内，我们进一步完善了董事遴选机制，增加了专业背景因素考量，以适应集团转型需求。同时，我们优化了董事会技能矩阵评估工具，持续加强董事会履责能力。\n\n通过上述措施，金蝶国际在企业管治方面取得了显著成果。目前，集团董事会成员具备丰富的专业背景和行业经验，涵盖企业战略与管理、财务会计、科技创新与信息技术等不同领域。这不仅提升了董事会的综合决策能力，也为企业的可持续发展提供了坚实的基础。我们相信，独立多元的董事会构成能够为金蝶带来广泛视角和专业见解，有助于更全面、客观地规划和决策集团未来的发展方向。同时，董事会成员的多元背景能将不同领域观点和经验汇入金蝶，为企业创新、风险管理和可持续发展提供有力支持。\n\n\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 员工总数 | 12149.00 | 12348.00 | 12036.00 |\n| 员工总数_全职员工 | 12149.00 | 12348.00 | 12036.00 |\n| 员工总数_实习员工 | 396.00 | 455.00 | 0.00 |\n| 男性员工人数 | 7841.00 | 7950.00 | 7789.00 |\n| 女性员工人数 | 4308.00 | 4398.00 | 4247.00 |\n| 30岁及以下员工人数_30岁以下(不含30岁) | 4276.00 | 4895.00 | 4589.00 |\n| 30-50岁员工人数 | 7640.00 | 7264.00 | 7246.00 |\n| 50岁以上员工人数 | 233.00 | 189.00 | 201.00 |\n| 硕士及以上学历员工人数 | 1137.00 | 1081.00 | 1033.00 |\n| 本科学历员工人数 | 10035.00 | 10218.00 | 9891.00 |\n| 专科及以下学历员工人数 | 977.00 | 1049.00 | 1112.00 |\n| 中国大陆员工人数 | 12098.00 | 12301.00 | 11995.00 |\n| 港澳台员工人数 | 44.00 | 47.00 | 40.00 |\n| 海外员工人数 | 7.00 | 0.00 | 1.00 |\n| 新进员工总数 | 1969.00 | 2346.00 | 2823.00 |\n| 新进男性员工人数 | 1355.00 | 1544.00 | 1852.00 |\n| 新进女性员工人数 | 614.00 | 802.00 | 971.00 |\n| 30岁以下新进员工人数 | 1355.00 | 1519.00 | 1738.00 |\n| 30-50岁新进员工人数 | 607.00 | 823.00 | 1081.00 |\n| 50岁以上新进员工人数 | 7.00 | 4.00 | 4.00 |\n| 按地区划分的员工人数_新进员工 | 1953.00 | 2334.00 | 2809.00 |\n| 中国大陆新进员工人数 | 1953.00 | 2334.00 | 2809.00 |\n| 港澳台新进员工人数 | 12.00 | 12.00 | 14.00 |\n| 海外新进员工人数 | 4.00 | 0.00 | 0.00 |\n| 30岁以上的员工总数 | 0.00 | 0.00 | 0.00 |\n| 员工培训参与人次 | 15060.00 | 13032.00 | 12573.00 |\n| 员工培训覆盖率 | 100.00 | 100.00 | 100.00 |\n| 接受培训的员工数 | 0.00 | 0.00 | 0.00 |\n| 员工培训总时长 | 428378.00 | 211245.00 | 138309.00 |\n| 员工人均受训时长 | 28.44 | 16.20 | 11.49 |\n| 员工培训总投入 | 0.86 | 0.00 | 0.00 |\n| 男性员工受训比例 | 100.00 | 100.00 | 100.00 |\n| 接受培训的男性员工数 | 0.00 | 0.00 | 0.00 |\n| 女性员工受训比例 | 100.00 | 100.00 | 100.00 |\n| 接受培训的女性员工数 | 0.00 | 0.00 | 0.00 |\n| 管理人员受训比例_高级管理层 | 100.00 | 100.00 | 100.00 |\n| 高级管理层中的管理人员总数 | 0.00 | 0.00 | 0.00 |\n| 高级管理层中受训的管理人员数量 | 0.00 | 0.00 | 0.00 |\n| 管理人员受训比例_中级管理层 | 100.00 | 100.00 | 100.00 |\n| 中级管理层人员总数 | 0.00 | 0.00 | 0.00 |\n| 接受培训的中级管理层人员数量 | 0.00 | 0.00 | 0.00 |\n| 管理人员受训比例_初级管理层 | 100.00 | 100.00 | 100.00 |\n| 初级管理层人员总数 | 0.00 | 0.00 | 0.00 |\n| 接受培训的初级管理层人员数量 | 0.00 | 0.00 | 0.00 |\n| 非管理人员受训比例 | 100.00 | 100.00 | 100.00 |\n| 总非管理人员数量 | 0.00 | 0.00 | 0.00 |\n| 已接受培训的非管理人员数量 | 0.00 | 0.00 | 0.00 |\n| 男性员工人均受训时长 | 28.44 | 16.20 | 11.90 |\n| 女性员工人均受训时长 | 28.44 | 16.20 | 10.75 |\n| 管理人员人均受训时长_高级管理层 | 5.00 | 0.00 | 0.00 |\n| 管理人员人均受训时长_中级管理层 | 30.00 | 0.00 | 0.00 |\n| 管理人员人均受训时长_初级管理层 | 33.00 | 0.00 | 0.00 |\n| 非管理人员人均受训时长 | 28.00 | 0.00 | 0.00 |\n| 中级管理层员工总数 | 0.00 | 0.00 | 0.00 |\n| 初级管理层员工总数 | 0.00 | 0.00 | 0.00 |\n| 满意员工数 | 0.00 | 0.00 | 0.00 |\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 贪腐相关法律诉讼案件数量 | 0.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（董事）_接受反贪污培训的董事数量 | 7.00 | 7.00 | 2.00 |\n| 反贪腐培训覆盖率（董事） | 100.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（员工）_接受反贪污培训的员工数量 | 12149.00 | 1253.00 | 4283.00 |\n| 反贪腐培训覆盖率（员工） | 100.00 | 0.00 | 0.00 |\n| 商业道德审计覆盖率 | 100.00 | 0.00 | 0.00 |\n| 已接受商业道德审计的实体数量 | 0.00 | 0.00 | 0.00 |',
                      '鉴于全球范围内对数据安全、员工健康与安全、商业道德及系统性风险管理的日益重视，金蝶国际积极响应并支持《中华人民共和国数据安全法》、《中华人民共和国个人信息保护法》、《网络安全法》、《欧盟通用数据保护条例》（GDPR）、《中华人民共和国安全生产法》、《中华人民共和国职业病防治法》、《女职工劳动保护特别规定》、《中华人民共和国反不正当竞争法》、《中华人民共和国反垄断法》等国内外相关法律法规。我们致力于通过建立全面的风险管理体系，确保企业运营的合规性和可持续发展。\n\n金蝶国际建立了包括治理层、管理层和执行层的三级风险管理架构，形成了自上而下的政策指导和自下而上的风险报告机制。治理层对风险管理负最高责任，确保风险管理体系的有效性。管理层统筹风险管理工作，定期向董事会汇报工作情况并提供建议，同时指导和监督执行层工作，推动集团整体风险管理目标的实现。执行层负责风险管理的具体实施，开展各领域的风险管理活动，定期向管理层汇报并提供建议。这种多层级的架构设计确保了风险管理的全面性、系统性和有效性，实现了风险管理责任的清晰划分和有效传导。金蝶国际将可持续发展理念与致良知走正道行王道的价值观有机融合，通过构建规范治理体系、全面风险防控机制和高标准实施商业道德管理，全面提升公司治理效能，夯实可持续发展根基，为股东、客户、员工及社会等利益相关方创造长期可持续价值。金蝶国际已建立覆盖风险识别、风险评估、风险应对、风险监控与报告等环节的全生命周期风险管理流程。我们将风险因素纳入风险识别与评估流程，借鉴优秀风险管理实践并结合自身业务特点制定风险应对计划，持续强化风险管理水平。风险管理部每季度组织跨部门研讨，识别潜在新兴风险，通过外部咨询、行业报告等渠道获取前瞻性信息，重点关注前所未有的、缺乏历史经验的风险领域。金蝶国际高度重视新兴风险的识别和管理，参考世界经济论坛全球风险报告，对中长期可能产生潜在重大影响的新兴风险进行识别评估，并制定应对举措。设立创新部门开展前瞻性研究，并与领先企业建立战略合作，探索治理框架，建立内部规范与审查机制，将合规要求融入到现有产品中，提升客户价值，对员工开展科技伦理和数据与隐私保护培训。\n\n金蝶国际通过意识培养、能力建设、实践参与三级机制建立全面的风险管理文化体系，系统性提升全员风险意识和应对能力。定期分享内外部风险事件案例，提升风险防范意识。鼓励员工提出风险管理改善建议，激励机制包括多个风险管理专职部门将风险管理基础知识培训纳入绩效考核指标。中层管理者进行风险识别与评估、风险应对策略等进阶培训，基层员工进行岗位相关风险防控操作规范等基础培训。金蝶国际根据运营所在地法律法规及风险管理标准制定并发布金蝶国际风险管理声明，持续优化风险治理架构与管理流程，强化风险识别、评估、应对与监控，全面提升风险管理能力，推动集团稳定健康发展。\n\n\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 因工亡故人数 | 0.00 | 0.00 | 0.00 |\n| 因工伤损失工作日数 | 52.00 | 25.00 | 29.00 |\n| 雇员体检覆盖率 | 100.00 | 100.00 | 100.00 |\n| 已进行体检的雇员数量 | 0.00 | 0.00 | 0.00 |\n| 安全应急演练次数 | 24.00 | 12.00 | 15.00 |\n| 安全生产投入/劳动保护投入_健康 | 0.20 | 0.00 | 0.00 |\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 贪腐相关法律诉讼案件数量 | 0.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（董事）_接受反贪污培训的董事数量 | 7.00 | 7.00 | 2.00 |\n| 反贪腐培训覆盖率（董事） | 100.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（员工）_接受反贪污培训的员工数量 | 12149.00 | 1253.00 | 4283.00 |\n| 反贪腐培训覆盖率（员工） | 100.00 | 0.00 | 0.00 |\n| 商业道德审计覆盖率 | 100.00 | 0.00 | 0.00 |\n| 已接受商业道德审计的实体数量 | 0.00 | 0.00 | 0.00 |',
                      '鉴于企业管治在可持续发展中的重要性，金蝶国际将可持续发展理念与致良知走正道行王道的价值观有机融合。我们通过构建规范治理体系、全面风险防控机制和高标准实施商业道德管理，全面提升公司治理效能，夯实可持续发展根基，为股东、客户、员工及社会等利益相关方创造长期可持续价值。我们严格遵守《中华人民共和国反垄断法》、《中华人民共和国反不正当竞争法》、《香港防止贿赂条例》、《竞争条例》等法律法规，将反腐败、反贿赂、利益冲突等重大问题设为集团底线。\n\n金蝶国际已建立系统的管理体系以应对商业道德议题。我们将商业道德风险纳入整体风险管理体系中，风险管理架构适用于商业风险管理。集团董事会对商业道德管理负最终责任，并对商业道德相关工作执行最高监督。我们制定了《金蝶集团劳工雇佣与道德行为指南》、《金蝶纪律处分条例》、《金蝶生态合作伙伴违规处罚管理办法》、《特殊事项报备及处理说明》等商业道德规范制度文件，针对反腐败与反贿赂、商业秘密保护、利益冲突、反垄断与反不正当竞争、反洗钱与内幕交易以及规范慈善捐赠等内容做出明确要求。我们定期审阅上述商业道德相关制度文件，根据法律法规和业务实践进行内容修订。报告期内，我们对《金蝶纪律处分条例》进行了修订更新，完善在新业务模式和场景下的违规舞弊行为及相应处分处罚形式。此外，我们建立了商业道德审核机制，定期针对所有运营点开展商业道德审计，审计内容包括内部商业道德政策遵从、商业道德风险识别与管理等。集团审计部负责对组织各模块业务经营承担主要监督责任，每年通过常规经营审计、员工举报等内外部线索锁定违纪人员及相关业务范围，对涉及违规舞弊的事件开展调查和后续处理。\n\n报告期内，金蝶国际对内部所有组织进行了常规经营审计或专项审计，查处起违规违纪案件起，涉及伙伴违规。我们严肃处理财经违纪、信息安全违规、营销领域违纪等违规违纪行为，捍卫集团底线。为加强对集团商业道德问题的内外部监督，我们为员工、客户、供应商及合作伙伴等各类利益相关方开放举报渠道，并建立一套完善的案件举报接受与处理流程。我们严格保护举报人的个人信息，并禁止任何形式的打击报复行为。举报制度及渠道包括电子信箱、电话、面谈或其他方式进行举报。《金蝶集团劳工雇佣与道德行为指南》、《金蝶纪律处分条例》等相关制度文件中均有专门模块对集团的举报政策和规定进行了阐述。《金蝶云社区阳光合作承诺书》等相关制度条款均注明了关于针对商业道德的举报政策和途径。徐少春个人号也可以收集相关投诉举报信息。报告期内，我们开展了多次廉洁培训活动，严禁商业贿赂、严禁串标围标、配合反舞弊调查、严禁行贿及其他严禁资金往来、利益冲突及其他披露、反舞弊举报义务。\n\n\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 因工亡故人数 | 0.00 | 0.00 | 0.00 |\n| 因工伤损失工作日数 | 52.00 | 25.00 | 29.00 |\n| 雇员体检覆盖率 | 100.00 | 100.00 | 100.00 |\n| 已进行体检的雇员数量 | 0.00 | 0.00 | 0.00 |\n| 安全应急演练次数 | 24.00 | 12.00 | 15.00 |\n| 安全生产投入/劳动保护投入_健康 | 0.20 | 0.00 | 0.00 |\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 中国大陆供应商数量 | 1182.00 | 459.00 | 348.00 |\n| 按地区划分的供应商数量_海外供应商 | 1.00 | 0.00 | 0.00 |\n| 供应商总数_一级供应商 | 1183.00 | 0.00 | 0.00 |\n| 重要供应商数量 | 149.00 | 0.00 | 0.00 |\n| 签署行为准则/廉洁承诺的供应商比例_签署《供应商CSR行为准则》或相关准则的供应商数量 | 1183.00 | 459.00 | 0.00 |\n| 签署行为准则/廉洁承诺的供应商比例_签署《阳光合作承诺书》的供应商数量 | 1183.00 | 182.00 | 0.00 |\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 员工总数_外包员工(劳务派遣) | 134.00 | 243.00 | 0.00 |\n| 内部招聘比例 | 48.51 | 36.20 | 0.00 |\n| 内部招聘人数 | 0.00 | 0.00 | 0.00 |\n| 员工流失率 | 17.85 | 16.26 | 0.00 |\n| 离职员工数量 | 0.00 | 0.00 | 0.00 |\n| 员工流失率_自愿 | 10.69 | 0.00 | 0.00 |\n| 自愿离职的员工数 | 0.00 | 0.00 | 0.00 |\n| 男性员工流失率 | 18.67 | 16.65 | 21.08 |\n| 男性员工离职人数 | 0.00 | 0.00 | 0.00 |\n| 女性员工流失率 | 16.34 | 14.48 | 17.26 |\n| 女性员工离职人数 | 0.00 | 0.00 | 0.00 |\n| 30岁以下员工流失率 | 23.76 | 23.92 | 24.80 |\n| 30岁以上离开公司的员工数 | 0.00 | 0.00 | 0.00 |\n| 30-50岁员工流失率 | 14.96 | 10.70 | 16.88 |\n| 30-50岁离职员工数 | 0.00 | 0.00 | 0.00 |\n| 50岁以上员工流失率 | 12.88 | 6.88 | 6.97 |\n| 50岁以上离职员工数 | 0.00 | 0.00 | 0.00 |\n| 中国大陆员工流失率 | 17.77 | 15.89 | 19.64 |\n| 中国大陆离职员工数 | 0.00 | 0.00 | 0.00 |\n| 港澳台员工流失率 | 40.91 | 12.77 | 47.50 |\n| 港澳台员工离职人数 | 0.00 | 0.00 | 0.00 |\n| 海外员工流失率 | 0.00 | 0.00 | 0.00 |\n| 海外员工离职人数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_男性 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工数量_男性 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_女性 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的女性员工数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_高级管理层 | 100.00 | 0.00 | 0.00 |\n| 高级管理层员工总数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的高级管理层员工数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_中级管理层 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的中级管理层员工数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_初级管理层 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的初级管理层员工数 | 0.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的员工占比_普通员工 | 100.00 | 0.00 | 0.00 |\n| 接受定期绩效评估的普通员工数 | 0.00 | 0.00 | 0.00 |\n| 休育儿假员工总数 | 121.00 | 133.00 | 194.00 |\n| 产假后复职员工人数 | 296.00 | 227.00 | 147.00 |\n| 指标名称 | 2024 | 2023 | 2022 |\n|-----------|-----------|-----------|-----------|\n| 贪腐相关法律诉讼案件数量 | 0.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（董事）_接受反贪污培训的董事数量 | 7.00 | 7.00 | 2.00 |\n| 反贪腐培训覆盖率（董事） | 100.00 | 0.00 | 0.00 |\n| 反贪腐培训覆盖率（员工）_接受反贪污培训的员工数量 | 12149.00 | 1253.00 | 4283.00 |\n| 反贪腐培训覆盖率（员工） | 100.00 | 0.00 | 0.00 |\n| 商业道德审计覆盖率 | 100.00 | 0.00 | 0.00 |\n| 已接受商业道德审计的实体数量 | 0.00 | 0.00 | 0.00 |',
                      ]
    result = asyncio.run(main_report_writing_begining(title, "关于本报告", company_name, data_text))# (main_report_writing_summary_title(section_title, result_content)) #(main_report_writing_body(paragraph_title, company_name, data_text, [], 123, 1))

    with open('report_writing_test2.md', "w", encoding="utf-8") as f:
        f.write(result)
    print(time.time() - start_time)

 
